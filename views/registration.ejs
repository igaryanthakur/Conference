<!DOCTYPE html>
<html lang="en">
  <%- include('partials/head', { title: 'Registration - IC-NBITS 2026' }) %>

  <body>
    <%- include('partials/header') %>

    

    <%- include('partials/footer') %> <%- include('partials/scripts') %>

    <script>
      (function () {
        var form = document.getElementById("registrationForm");
        if (!form) {
          alert("Form not found!");
          return;
        }

        form.onsubmit = function (e) {
          e.preventDefault();

          var fullName = document.getElementById("fullName").value.trim();
          var email = document.getElementById("email").value.trim();
          var affiliation = document.getElementById("affiliation").value.trim();
          var category = document.getElementById("category").value;
          var mode = document.querySelector('input[name="mode"]:checked');
          var comments = document.getElementById("comments").value.trim();
          var agree = document.getElementById("agree").checked;

          if (!fullName) {
            alert("Please enter your full name.");
            return false;
          }
          if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            alert("Please enter a valid email address.");
            return false;
          }
          if (!category) {
            alert("Please choose a registration category.");
            return false;
          }
          if (!agree) {
            alert("You must agree to the terms to proceed.");
            return false;
          }

          var msg = document.getElementById("registrationMessage");
          msg.textContent = "Submitting...";
          msg.style.color = "#333";

          var data = {
            fullName: fullName,
            email: email,
            affiliation: affiliation,
            category: category,
            mode: mode ? mode.value : "",
            comments: comments,
          };

          var xhr = new XMLHttpRequest();
          xhr.open("POST", "/register", true);
          xhr.setRequestHeader("Content-Type", "application/json");
          xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
              if (xhr.status === 200) {
                var result = JSON.parse(xhr.responseText);
                if (result.success) {
                  msg.textContent =
                    "Thank you â€” your registration request is received. We will contact you via email.";
                  msg.style.color = "#0b6b3e";
                  form.reset();
                } else {
                  msg.textContent =
                    result.message || "Registration failed. Please try again.";
                  msg.style.color = "#b30000";
                }
              } else {
                msg.textContent = "Server error. Please try again later.";
                msg.style.color = "#b30000";
              }
            }
          };
          xhr.send(JSON.stringify(data));
          return false;
        };
      })();
    </script>
  </body>
</html>
